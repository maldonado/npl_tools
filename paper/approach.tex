The main goal of our study is to predict if a comment is a \SADTD. In a previous work Maldonado and Shihab 


extract comment patterns that can be used to effectively identify \SADTD. Figure~\ref{fig:approach} shows an overview of our approach. The following subsections detail each step of our approach.
 
\subsection{Data Extraction}

To perform our study, we obtain the source of ten large open source projects, namely Apache Ant, Jakarta Jmeter, ArgoUML,  Columba, EMF, Hibernate, JEdit, JFreeChart, JRuby and SQuirrel SQL Client. We chose the aforementioned projects, since they belong to different domains, and vary in size (e.g., LOC), and in the number of contributors.

Table~\ref{tab:projDetails} provides statistics about each of the projects used in our study. In total, we obtained more than 258,878 comments, found in 16,249 files. We also include the release used, the number of classes, and the total lines of code (LOC). In our study, we only use the Java files to calculate the LOC. It is important to notice that the number of comments shown for each project does not represent the number of commented lines, but rather the number of individual line, block, and Javadoc comments. 


\begin{table*}[!tbh]
    \begin{center}
        \caption{Case Study Project Details and Statistics}
        \vspace{-2mm}
        \label{tab:projDetails}
        \begin{tabular}{l| c c c c c | p{2.5in}}
            \toprule
            \textbf{Project} & \textbf{Release} & \textbf{LOC} & \textbf{Classes} & \textbf{Comments} & \textbf{Contributors} & \textbf{Description}                                                      
            \\ \midrule
            Apache Ant       & 1.7.0            & 115,881      & 1,475            & 21,587            & 70                    & A Java library and command-line tool to build Java applications.           \\
            Jakarta Jmeter   & 2.3.2            & 81,307       & 1,181            & 20,084            & 32                    & An application to measure performance and assert functional behavior.      \\
            ArgoUML          & 0.34             & 176,839      & 2,609            & 67,716            & 87                    & An UML modeling tool.                                                      \\
            Columba          & 1.4              & 100,200      & 1,711            & 33,895            & 9                     & A desktop email client written in Java.                                    \\
            EMF              & 2.4.1            & 228,191      & 1,458            & 25,229            & 28                    & Eclipse Modeling Framework.                                                \\
            Hibernate        & 3.3.2 GA         & 173,467      & 1,356            & 11,630            & 216                   & An Object Relational Mapping framework.                                    \\
            JEdit            & 4.2              & 88,583       & 800              & 16,991            & 55                    & A light weight text editor.                                                \\
            JFreeChart       & 1.0.19           & 132,296      & 1,065            & 23,123            & 18                    & A Java library to display graphics and charts.                             \\
            JRuby            & 1.4.0            & 150,060      & 1,486            & 11,149            & 291                   & Is the implementation of the Ruby language using the Java Virtual Machine. \\
            SQuirrel         & 3.0.3            & 215,234      & 3,108            & 27,474            & 40                    & A graphical SQL client written in Java.                                    
            \\ \bottomrule
        \end{tabular}
    \end{center}
\end{table*}

 
\subsection{Parse Source Code}

After obtaining the source code of all projects, we extract the comments from their source code. We use JDeodorant~\cite{Tsantalis2008CSMR}, an open-source Eclipse plug-in, to parse the source code and extract the code comments. Once extracted, we store all comments in a relational database to facilitate the processing of the data.

\subsection{Identification of \SADTD~Comment Patterns}
Once we store all comments in the database, our next step is to identify the \SADTD~comment patterns. Since we are dealing with natural language in the comments, it is challenging to automatically determine what comments indicate design technical debt. Therefore, we opted to use two different approaches to determine comment patterns that indicate design technical debt. First, we use the terms mentioned in prior work~\cite{fowler1999refactoring,brown1998antipatterns,martin2009clean} (i.e., code smell and anti-pattern names) as indicators of design problems to determine comments that are indicative of design technical debt. Second, we manually examined and classified all  comments of one project i.e., Apache Ant, in order to determine comment patterns that are indicative of \SADTD. After analyzing the results, we found that combining comment patterns from the two aforementioned approaches provides the best results. We detail the steps taken to achieve each of the two approaches.

\subsubsection{Applying Heuristics to Eliminate Irrelevant Comments}

When applying our first approach, i.e., using the terms in the prior work to identify comments that are indicative of \SADTD, we found that we are able to flag comments that indicate design issues, but also flag many false positives. We analyzed the false positives to see whether we can gain any insight into why they appear and how we can eliminate them. 

We identified three main types of false positives. First, license comments, containing copyright information and legal rights. Second, commented source code containing Java keywords, e.g., ``big'' and ``long''. Finally, Javadoc comments were flagged, however, they often had no relation to design issues. As a result, we came up with three heuristics and a post-processing step to reduce the number of false positives.

\begin{table*}[!hbt]
    \begin{center}
        \caption{Number of Comments After the Application of Each Heuristic}
        \vspace{-2mm}
        \label{tab:heuristicDetails}
        \begin{tabular}{l| p{.6in} p{.6in} p{.8in} p{.7in} p{.55in}} 
            \toprule
            \textbf{Project} &  \textbf{Initial no. of Comments} & \textbf{After license heuristic} &  \textbf{After comment code heuristic}  &  \textbf{After Javadoc heuristic} & \textbf{After post processing} \\ 
            \midrule
            Apache Ant & 21,587 & 20,421 & 20,268 & 6,239 & 4,436 \\ 
            Jakarta Jmeter & 20,084& 18,840 & 18,530 & 12,360 & 8,126 \\
            ArgoUML & 67,716 & 28,180 & 27,848 & 13,972 & 10,303 \\
            Columba & 33,895 & 14,600 & 14,256 & 9,095 & 6,825 \\
            EMF & 25,229 & 24,355 & 24,093 & 8,861 & 5,868 \\
            Hibernate  & 11,630 & 10,446 & 10,277 & 4,908 & 3,071 \\
            JEdit & 16,991 & 16,128 & 16,037 & 13,118 & 11,232 \\
            JFreeChart & 23,123 & 22,114 & 22,047 & 5,902 & 4,449 \\
            JRuby & 11,149 & 10,274 & 10,080 & 6,887 & 5,176 \\
            SQuirrel  & 27,474& 25,566 & 25,196 & 13,713 & 8,627 \\  
            \bottomrule
        \end{tabular}
    \end{center}
\end{table*}
  
 
\begin{itemize}


\item{\textbf{Heuristic to remove license comments.}} 
When license comments are added to the Java files in a project they are generally placed in the first lines of the file, before the class declaration. Based on this knowledge we created a heuristic that eliminates comments that are placed before the class declaration. To validate the result of this heuristic we examined a sample of the comments being removed to check if they were indeed license comments. We noticed that some comments were placed before the class declaration although they were not license comments. To mitigate the risk of eliminating important comments, we added one more condition: If the comment contains one of the task-reserved words (e.g. ``todo'', ``fixme'', or ``xxx'') we do not remove the comment.

\item{\textbf{Heuristic to remove commented source code.}}
If a commented piece of source code contains Java keywords like ``long'' or ``big'', it will increase the number of false positives of our approach. Commented source code can be found for several different reasons. One of the possibilities could be that the code is not being currently used, or if the particular piece of code is used to debug the program. Since commented code does not have \SADTD, we remove commented source code using a regular expressions that captures typical Java code structures.

\item{\textbf{Heuristic to remove Javadoc comments.}}
The Javadoc comments contain information about the purpose and use of methods and classes. That said, Javadoc comments rarely mention \SADTD. Therefore, we create a heuristic that removes Javadoc comments. To mitigate the risk of eliminating some correct cases, we added one exception - if the comment contains one of the task-reserved words (e.g. ``todo'', ``fixme'', or ``xxx'') we keep that Javadoc comment. 

\item{\textbf{Post processing technique to merge multiple line comments}}
Another problem that we found while analyzing the comments was that some times developers make long comments, using multiple single-line comments instead of a Block comment. Treating every single line of a long comment as an individual comment causes us to miss important context details that could be recovered by treating all single-line comments as a single block comment. Therefore, we create a post processing technique that searches for consecutive single-line comments and groups them. 

\end{itemize}

The steps mentioned above significantly reduced the number of comments in our dataset and helped us focus on the most applicable and insightful comments. For example, in the Apache Ant project, applying the above steps helped reduce the number of comments from 21,587 to 4,436 comments.

\subsubsection{Manual investigation of identified \SADTD~comments} 

In addition to using the words that indicate design issues to detect \SADTD, we also manually examine our dataset to extract comment patterns that indicate~\SADTD~comments. We started by examining all of the 4,436 comments for the Apache Ant project and classified each comment as being related to \SADTD or not. Since our focus in this work is on design debt, comments related to other types of technical debt were not labeled as \SADTD comments. The classification of the Apache Ant comments took approximately 32 hours and was performed by the first author of the paper.

\noindent \textbf{Manual Examination of Comments to Identify \SADTD~Comment Patterns}

In the end of the classification we identified 93 \SADTD~related comments out of 4,436 comments in Apache Ant project.

Our next goal was to abstract the comments and come up with a set of \emph{comment patterns} that indicate \SADTD. Comment patterns are general patterns that represent one or more comments. Simply using a single word to identify \SADTD~comments can be misleading since the context that the word appears in can completely change the meaning of that word. In order to address this issue, we take into consideration some of the other words that appear in the same sentence to combine them into what we call comment patterns. 

By the end of this step, we had identified the comment patterns that indicate \SADTD. \textbf{In total, we had 176 comment patterns that can be used to detect \SADTD}. To facilitate future work in the area, we make our dataset and the comment patterns publicly available \footnote{http://users.encs.concordia.ca/~e\_silvam/publications.html}. 

Table \ref{tab:dictionarySample} provides a sample of the comment patterns that we used to identify \SADTD~comments. The `\%' symbol indicates that the pattern uses the SQL language wildcards. Wildcards make the query to match anything before or after the wildcard symbol. For example, ``dependen\%'' would result in positive results for comments that contains the words ``dependency'' or ``dependencies''.

\begin{table}[t!]
    \begin{center}
        \caption{Sample \SADTD Comment Patterns}
        \vspace{-2mm}
        \label{tab:dictionarySample}
        \begin{tabular}{ c }
            \toprule
            \textbf{Related Comment Patterns} \\ 
            \midrule
                 `\%future\%may\%'       \\
                 `\%future\%better\%'  \\
                 `\%future\%enhance\%' \\ 
                 `\%future\%change\%'  \\   
             `\%dependency\%cycle\%'  \\
             `\%todo\%dependenc\%'    \\
             `\%fixme\%dependenc\%'   \\
             `\%xxx\%dependenc\%'    \\
            \bottomrule             
        \end{tabular}
    \end{center}    
\end{table}

Once we derive the 176 comment patterns that indicate \SADTD, we use these patterns to answer our research questions, which we detail in the next section.